import{J as C,d as ee,r as i,S as de,e as s,o as _,v as A,w as l,b as e,c as F,F as G,q as O,m as W,f as Q,h as H,t as ie,L as h,A as ce,a as pe,R as me,s as _e,O as le,z as ve,H as fe,K as ge,B,C as Z}from"./index-e4bf949e.js";const Se=(v,T,w)=>C.get(`/admin/product/${v}/${T}?category3Id=${w}`),ae=()=>C.get("/admin/product/baseTrademark/getTrademarkList"),ne=v=>C.get("/admin/product/spuImageList/"+v),ue=v=>C.get("/admin/product/spuSaleAttrList/"+v),te=()=>C.get("/admin/product/baseSaleAttrList"),be=v=>v.id?C.post("/admin/product/updateSpuInfo",v):C.post("/admin/product/saveSpuInfo",v),ye=v=>C.post("/admin/product/saveSkuInfo",v),ke=v=>C.get("/admin/product/findBySpuId/"+v),Ve=v=>C.delete("/admin/product/deleteSpu/"+v),Ae=["src"],Ie=ee({__name:"spuForm",emits:["changeScene"],setup(v,{expose:T,emit:w}){const k=i([]),f=i([]),p=i([]),I=i([]),u=i({spuName:"",description:"",category3Id:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),N=i(!1),x=i(""),U=i(""),j=()=>{w("changeScene",{scene:0,params:"update"})},S=i([]),r=t=>{x.value=t.url,N.value=!0},c=()=>{},m=t=>t.type=="image/png"||t.type=="image/jpeg"||t.type=="image/gif"?t.size/1024/1024<3?!0:(h.error("上传文件务必小于3M"),!1):(h.error("上传文件务必PNG|JPG|GIF"),!1),y=de(()=>I.value.filter(n=>p.value.every(d=>n.name!=d.saleAttrName))),$=()=>{const[t,n]=U.value.split(":");let d={baseSaleAttrId:t,saleAttrName:n,spuSaleAttrValueList:[]};p.value.push(d),U.value=""},z=(t,n)=>{t.flag=!0,t.saleAttrValue="",ce(()=>{S.value[n].focus()})},D=t=>{const{baseSaleAttrId:n,saleAttrValue:d}=t,V={baseSaleAttrId:n,saleAttrValueName:d};if((d==null?void 0:d.trim())==""){h.error("属性值不能为空");return}if(t.spuSaleAttrValueList.find(L=>L.saleAttrValueName==d)){h.error("属性值不能重复");return}t.spuSaleAttrValueList.push(V),t.flag=!1},E=async()=>{u.value.spuImageList=f.value.map(n=>({imgName:n.name,imgUrl:n.response&&n.response.data||n.url})),u.value.spuSaleAttrList=p.value,(await be(u.value)).code===200?(h.success(u.value.id?"修改成功":"添加成功"),w("changeScene",{scene:0,params:u.value.id?"update":"add"})):h.error(u.value.id?"修改失败":"添加失败")};return T({initHasSpuData:async t=>{u.value=t;let n=await ae(),d=await ne(t.id),V=await ue(t.id),q=await te();k.value=n.data,f.value=d.data.map(L=>({name:L.imgName,url:L.imgUrl})),p.value=V.data,I.value=q.data},initAddSpu:async t=>{U.value="",Object.assign(u.value,{id:"",spuName:"",description:"",category3Id:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),f.value=[],p.value=[],u.value.category3Id=t;let n=await ae(),d=await te();k.value=n.data,I.value=d.data}}),(t,n)=>{const d=s("el-input"),V=s("el-form-item"),q=s("el-option"),L=s("el-select"),X=s("Plus"),Y=s("el-icon"),R=s("el-upload"),b=s("el-dialog"),M=s("el-button"),K=s("el-table-column"),oe=s("el-tag"),se=s("el-table"),re=s("el-form");return _(),A(re,{ref:"form","label-width":"100px",inline:!1},{default:l(()=>[e(V,{label:"SPU名称"},{default:l(()=>[e(d,{modelValue:u.value.spuName,"onUpdate:modelValue":n[0]||(n[0]=o=>u.value.spuName=o),placeholder:"请你输入SPU名称"},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU品牌"},{default:l(()=>[e(L,{modelValue:u.value.tmId,"onUpdate:modelValue":n[1]||(n[1]=o=>u.value.tmId=o),clearable:"",filterable:"",onChange:n[2]||(n[2]=()=>{})},{default:l(()=>[(_(!0),F(G,null,O(k.value,o=>(_(),A(q,{key:o.id,label:o.tmName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU描述"},{default:l(()=>[e(d,{modelValue:u.value.description,"onUpdate:modelValue":n[3]||(n[3]=o=>u.value.description=o),type:"textarea",placeholder:"请你输入SPU描述"},null,8,["modelValue"])]),_:1}),e(V,{label:"SPU图片"},{default:l(()=>[e(R,{"file-list":f.value,"onUpdate:fileList":n[4]||(n[4]=o=>f.value=o),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":r,"on-remove":c,"before-upload":m},{default:l(()=>[e(Y,null,{default:l(()=>[e(X)]),_:1})]),_:1},8,["file-list"]),e(b,{modelValue:N.value,"onUpdate:modelValue":n[5]||(n[5]=o=>N.value=o)},{default:l(()=>[W("img",{"w-full":"",src:x.value,alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ae)]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"SPU销售属性"},{default:l(()=>[e(L,{modelValue:U.value,"onUpdate:modelValue":n[6]||(n[6]=o=>U.value=o),clearable:"",placeholder:Q(y).length?`还未选择${Q(y).length}个`:"无"},{default:l(()=>[(_(!0),F(G,null,O(Q(y),o=>(_(),A(q,{key:o.id,label:o.name,value:`${o.id}:${o.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),e(M,{style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus",disabled:!U.value,onClick:$},{default:l(()=>[H(" 添加属性 ")]),_:1},8,["disabled"]),e(se,{data:p.value,style:{margin:"10px 0"},border:"",stripe:""},{default:l(()=>[e(K,{label:"序号",type:"index",align:"center",width:"80"}),e(K,{label:"销售属性名",prop:"saleAttrName",width:"120"}),e(K,{label:"销售属性值"},{default:l(({row:o,index:J})=>[(_(!0),F(G,null,O(o.spuSaleAttrValueList,P=>(_(),A(oe,{key:P.id,style:{margin:"0 5px"},closable:"",onClose:we=>o.spuSaleAttrValueList.splice(J,1)},{default:l(()=>[H(ie(P.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),o.flag?(_(),A(d,{key:0,modelValue:o.saleAttrValue,"onUpdate:modelValue":P=>o.saleAttrValue=P,ref:P=>S.value[J]=P,style:{width:"100px"},placeholder:"请你输入属性值",size:"small",clearable:"",onBlur:P=>D(o)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(_(),A(M,{key:1,type:"primary",size:"small",icon:"Plus",onClick:P=>z(o,J)},null,8,["onClick"]))]),_:1}),e(K,{label:"操作",width:"120"},{default:l(({row:o,index:J})=>[e(M,{type:"danger",size:"small",icon:"Delete",onClick:P=>p.value.splice(J,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(V,null,{default:l(()=>[e(M,{disabled:!(p.value.length>0),type:"primary",onClick:E},{default:l(()=>[H("保存")]),_:1},8,["disabled"]),e(M,{onClick:j},{default:l(()=>[H("取消")]),_:1})]),_:1})]),_:1},512)}}}),Ue=["src"],he=ee({__name:"skuForm",emits:["changeScene"],setup(v,{expose:T,emit:w}){const k=i([]),f=i([]),p=i([]),I=i(),u=pe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),N=async(S,r,c)=>{u.category3Id=c.category3Id,u.spuId=c.id,u.tmId=c.tmId;let m=await me(S,r,c.category3Id),y=await ue(c.id),$=await ne(c.id);k.value=m.data,f.value=y.data,p.value=$.data},x=()=>{w("changeScene",{scene:0,params:""})},U=S=>{p.value.forEach(r=>{I.value.toggleRowSelection(r,!1)}),I.value.toggleRowSelection(S,!0),u.skuDefaultImg=S.imgUrl},j=async()=>{u.skuAttrValueList=k.value.reduce((r,c)=>{if(c.attrIdAndValueId){let[m,y]=c.attrIdAndValueId.split(":");r.push({attrId:m,valueId:y})}return r},[]),u.skuSaleAttrValueList=f.value.reduce((r,c)=>{if(c.saleIdAndValueId){let[m,y]=c.saleIdAndValueId.split(":");r.push({saleAttrId:m,valueId:y})}return r},[]);let S=await ye(u);console.log(S),S.code==200?(h.success("添加sku成功"),w("changeScene",{scene:0,params:""})):h.error("添加sku失败")};return T({initSkuData:N}),(S,r)=>{const c=s("el-input"),m=s("el-form-item"),y=s("el-option"),$=s("el-select"),z=s("el-form"),D=s("el-table-column"),E=s("el-button"),g=s("el-table");return _(),A(z,{ref:"form","label-width":"100px"},{default:l(()=>[e(m,{label:"SKU名称"},{default:l(()=>[e(c,{modelValue:u.skuName,"onUpdate:modelValue":r[0]||(r[0]=a=>u.skuName=a),placeholder:"SKU名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"价格(元)"},{default:l(()=>[e(c,{modelValue:u.price,"onUpdate:modelValue":r[1]||(r[1]=a=>u.price=a),type:"number",placeholder:"价格(元)"},null,8,["modelValue"])]),_:1}),e(m,{label:"重量(克)"},{default:l(()=>[e(c,{modelValue:u.weight,"onUpdate:modelValue":r[2]||(r[2]=a=>u.weight=a),type:"number",placeholder:"重量(克)"},null,8,["modelValue"])]),_:1}),e(m,{label:"SKU描述"},{default:l(()=>[e(c,{modelValue:u.skuDesc,"onUpdate:modelValue":r[3]||(r[3]=a=>u.skuDesc=a),type:"textarea",placeholder:"SKU名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"平台属性"},{default:l(()=>[e(z,{inline:"","label-width":"80"},{default:l(()=>[(_(!0),F(G,null,O(k.value,a=>(_(),A(m,{key:a.id,label:a.attrName},{default:l(()=>[e($,{modelValue:a.attrIdAndValueId,"onUpdate:modelValue":t=>a.attrIdAndValueId=t,placeholder:"请选择"},{default:l(()=>[(_(!0),F(G,null,O(a.attrValueList,t=>(_(),A(y,{key:t.id,label:t.valueName,value:`${a.id}:${t.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,{label:"销售属性"},{default:l(()=>[e(z,{inline:"","label-width":"80"},{default:l(()=>[(_(!0),F(G,null,O(f.value,a=>(_(),A(m,{key:a.id,label:a.saleAttrName},{default:l(()=>[e($,{modelValue:a.saleIdAndValueId,"onUpdate:modelValue":t=>a.saleIdAndValueId=t,placeholder:""},{default:l(()=>[(_(!0),F(G,null,O(a.spuSaleAttrValueList,t=>(_(),A(y,{key:t.id,label:t.saleAttrValueName,value:`${a.id}:${t.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(m,{label:"图片名称"},{default:l(()=>[e(g,{data:p.value,border:"",ref_key:"table",ref:I},{default:l(()=>[e(D,{type:"selection",align:"center"}),e(D,{label:"图片"},{default:l(({row:a,index:t})=>[W("img",{src:a.imgUrl,style:{width:"100px",height:"100px"},alt:""},null,8,Ue)]),_:1}),e(D,{prop:"imgName",label:"名称"}),e(D,{label:"操作"},{default:l(({row:a,index:t})=>[e(E,{type:"primary",size:"small",onClick:n=>U(a)},{default:l(()=>[H("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(m,null,{default:l(()=>[e(E,{type:"primary",onClick:j},{default:l(()=>[H("保存")]),_:1}),e(E,{onClick:x},{default:l(()=>[H("取消")]),_:1})]),_:1})]),_:1},512)}}}),Ce=["src"],Le=ee({__name:"index",setup(v){const{c1Id:T,c2Id:w,c3Id:k}=_e(le()),f=i(0),p=i(1),I=i(5),u=i(0),N=i([]),x=i(),U=i(),j=i([]),S=i(!1),r=async(g=1)=>{p.value=g;let a=await Se(p.value,I.value,k.value);a.code===200&&(N.value=a.data.records,u.value=a.data.total)},c=()=>{r()},m=g=>{f.value=2,U.value.initSkuData(T.value,w.value,g)},y=()=>{f.value=1,x.value.initAddSpu(k.value)},$=g=>{f.value=1,x.value.initHasSpuData(g)},z=g=>{f.value=g.scene,g.params=="update"?r(p.value):r()},D=async g=>{let a=await ke(g.id);a.code==200&&(j.value=a.data,S.value=!0)},E=async g=>{(await Ve(g.id)).code==200?(h.success("删除成功"),r(N.value.length>1?p.value:p.value-1)):h.error("删除失败")};return ve(()=>k.value,()=>{k.value&&r()}),fe(()=>{le().$reset()}),(g,a)=>{const t=s("Category"),n=s("el-button"),d=s("el-table-column"),V=s("el-popconfirm"),q=s("el-table"),L=s("el-pagination"),X=s("el-card"),Y=s("el-dialog"),R=ge("has");return _(),F("div",null,[e(t,{scene:f.value},null,8,["scene"]),e(X,null,{default:l(()=>[B(W("div",null,[B((_(),A(n,{type:"primary",size:"default",icon:"Plus",disabled:!Q(k),onClick:y},{default:l(()=>[H(" 添加SPU ")]),_:1},8,["disabled"])),[[R,"btn.Spu.add"]]),e(q,{data:N.value,border:"",stripe:"",style:{margin:"10px 0"}},{default:l(()=>[e(d,{label:"序号",width:"80",type:"index",align:"center"}),e(d,{label:"SPU名称",prop:"spuName"}),e(d,{label:"SPU描述",prop:"description"}),e(d,{label:"SPU操作"},{default:l(({row:b,$index:M})=>[B(e(n,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:K=>m(b)},null,8,["onClick"]),[[R,"btn.Spu.addsku"]]),B(e(n,{type:"warning",size:"small",icon:"Edit",title:"修改SPU",onClick:K=>$(b)},null,8,["onClick"]),[[R,"btn.Spu.update"]]),B(e(n,{type:"info",size:"small",icon:"View",title:"查看SKU列表",onClick:K=>D(b)},null,8,["onClick"]),[[R,"btn.Spu.skus"]]),e(V,{title:`你确定删除${b.spuName}吗?`,width:"200px",onConfirm:K=>E(b)},{reference:l(()=>[B(e(n,{type:"danger",size:"small",icon:"Delete",title:"删除SPU",onClick:a[0]||(a[0]=()=>{})},null,512),[[R,"btn.Spu.delete"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(L,{"current-page":p.value,"onUpdate:currentPage":a[1]||(a[1]=b=>p.value=b),"page-size":I.value,"onUpdate:pageSize":a[2]||(a[2]=b=>I.value=b),"page-sizes":[5,10,15,20],background:"",layout:" prev, pager, next, jumper,->, sizes,total",total:u.value,onSizeChange:c,onCurrentChange:r},null,8,["current-page","page-size","total"])],512),[[Z,f.value==0]]),B(e(Ie,{ref_key:"spuForm",ref:x,onChangeScene:z},null,512),[[Z,f.value==1]]),B(e(he,{ref_key:"skuForm",ref:U,onChangeScene:z},null,512),[[Z,f.value==2]])]),_:1}),e(Y,{title:"SKU列表",modelValue:S.value,"onUpdate:modelValue":a[3]||(a[3]=b=>S.value=b)},{default:l(()=>[e(q,{data:j.value,border:""},{default:l(()=>[e(d,{prop:"skuName",label:"SKU名字"}),e(d,{prop:"price",label:"SKU价格"}),e(d,{prop:"weight",label:"SKU重量"}),e(d,{label:"SKU图片"},{default:l(({row:b,$index:M})=>[W("img",{src:b.skuDefaultImg,style:{width:"100px",height:"100px"},alt:""},null,8,Ce)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}});export{Le as default};
