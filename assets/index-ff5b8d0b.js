import{u as ce}from"./setting-2d7fbfb0.js";import{J as h,d as me,s as pe,r as u,a as ve,G as fe,e as i,K as _e,o as v,c as B,b as l,w as a,h as d,B as x,v as y,m as q,t as F,y as ge,F as M,q as be,A as G,L as z,p as ye,k as he,_ as we}from"./index-e4bf949e.js";const Ve=(s,R,c)=>h.get(`/admin/acl/user/${s}/${R}/?username=${c}`),Ce=s=>s.id?h.post("/admin/acl/user/update",s):h.post("/admin/acl/user/save",s),Ue=s=>h.get("/admin/acl/user/toAssign/"+s),ke=s=>h.post("/admin/acl/user/doAssignRole",s),xe=s=>h.delete("/admin/acl/user/remove/"+s),ze=s=>h.delete("/admin/acl/user/batchRemove",{data:s}),Re=s=>(ye("data-v-fe4dc148"),s=s(),he(),s),Se={style:{flex:"auto"}},qe=Re(()=>q("h4",null,"分配角色(职位)",-1)),Ie={style:{flex:"auto"}},$e=me({__name:"index",setup(s){const{refresh:R}=pe(ce()),c=u(1),I=u(5),E=u(0),S=u([]),f=u(!1),w=u(!1),V=u([]),C=u([]),n=ve({username:"",name:"",password:""}),$=u([]),_=u(),U=u("");fe(()=>{g()});const g=async(o=1)=>{c.value=o;let e=await Ve(c.value,I.value,U.value);e.code==200&&(E.value=e.data.total,S.value=e.data.records)},H=()=>{g()},J=()=>{f.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),G(()=>{_.value.clearValidate("username"),_.value.clearValidate("name"),_.value.clearValidate("password")})},K=o=>{f.value=!0,Object.assign(n,o),G(()=>{_.value.clearValidate("username"),_.value.clearValidate("name")})},Q=async()=>{await _.value.validate(),(await Ce(n)).code==200?(f.value=!1,z({type:"success",message:n.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,z({type:"error",message:n.id?"更新失败":"添加失败"}))},W=()=>{f.value=!1},X={username:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=6?r():r(new Error("用户密码至少六位"))}}]},Y=async o=>{Object.assign(n,o);let e=await Ue(n.id);e.code==200&&(V.value=e.data.allRolesList,C.value=e.data.assignRoles,w.value=!0)},A=u(!1),N=u(!0),Z=o=>{C.value=o?V.value:[],N.value=!1},ee=o=>{A.value=o.length===V.value.length,N.value=o.length!==V.value.length},le=async()=>{let o={userId:n.id,roleIdList:C.value.map(r=>r.id)};(await ke(o)).code==200&&(z({type:"success",message:"分配职务成功"}),w.value=!1,g(c.value))},ae=async o=>{(await xe(o)).code==200&&(z({type:"success",message:"删除成功"}),g(S.value.length>1?c.value:c.value-1))},te=o=>{$.value=o},oe=async()=>{let o=$.value.map(r=>r.id);(await ze(o)).code==200&&(z({type:"success",message:"删除成功"}),g(S.value.length>1?c.value:c.value-1))},ne=()=>{g(),U.value=""},se=()=>{R.value=!R.value};return(o,e)=>{const r=i("el-input"),b=i("el-form-item"),m=i("el-button"),D=i("el-form"),L=i("el-card"),p=i("el-table-column"),re=i("el-popconfirm"),ue=i("el-table"),de=i("el-pagination"),T=i("el-drawer"),j=i("el-checkbox"),ie=i("el-checkbox-group"),k=_e("has");return v(),B(M,null,[l(L,{style:{height:"80px"}},{default:a(()=>[l(D,{inline:!0,class:"form"},{default:a(()=>[l(b,{label:"用户名:"},{default:a(()=>[l(r,{placeholder:"请你输入搜索用户名",modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=t=>U.value=t)},null,8,["modelValue"])]),_:1}),l(b,null,{default:a(()=>[l(m,{type:"primary",size:"default",disabled:!U.value,onClick:ne},{default:a(()=>[d("搜索")]),_:1},8,["disabled"]),l(m,{type:"primary",size:"default",onClick:se},{default:a(()=>[d("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(L,{style:{margin:"10px 0px"}},{default:a(()=>[x((v(),y(m,{type:"primary",size:"default",onClick:J},{default:a(()=>[d("添加用户")]),_:1})),[[k,"btn.User.add"]]),x((v(),y(m,{type:"primary",size:"default",disabled:!$.value.length,onClick:oe},{default:a(()=>[d(" 批量删除 ")]),_:1},8,["disabled"])),[[k,"btn.User.remove"]]),l(ue,{onSelectionChange:te,style:{margin:"10px 0px"},border:"",data:S.value},{default:a(()=>[l(p,{type:"selection",align:"center",width:"50"}),l(p,{label:"#",align:"center",type:"index",width:"50"}),l(p,{label:"ID",align:"center",prop:"id"}),l(p,{label:"用户名字",align:"center",prop:"username",width:"150"}),l(p,{label:"用户名称",align:"center",prop:"name",width:"150"}),l(p,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":"",width:"150"}),l(p,{label:"创建时间",align:"center",prop:"createTime",width:"180"}),l(p,{label:"更新时间",align:"center",prop:"updateTime",width:"180"}),l(p,{label:"操作",fixed:"right",width:"300px",align:"center"},{default:a(({row:t,$index:O})=>[x((v(),y(m,{size:"small",icon:"User",onClick:P=>Y(t)},{default:a(()=>[d("分配角色")]),_:2},1032,["onClick"])),[[k,"btn.User.assgin"]]),x((v(),y(m,{type:"primary",size:"small",icon:"Edit",onClick:P=>K(t)},{default:a(()=>[d("编辑")]),_:2},1032,["onClick"])),[[k,"btn.User.update"]]),l(re,{title:`你确定要删除${t.username}?`,width:"260px",onConfirm:P=>ae(t.id)},{reference:a(()=>[x((v(),y(m,{type:"danger",size:"small",icon:"Delete"},{default:a(()=>[d("删除")]),_:1})),[[k,"btn.User.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(de,{"current-page":c.value,"onUpdate:currentPage":e[1]||(e[1]=t=>c.value=t),"page-size":I.value,"onUpdate:pageSize":e[2]||(e[2]=t=>I.value=t),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:E.value,onCurrentChange:g,onSizeChange:H},null,8,["current-page","page-size","total"])]),_:1}),l(T,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t)},{header:a(()=>[q("h4",null,F(n.id?"更新用户":"添加用户"),1)]),default:a(()=>[l(D,{model:n,rules:X,ref_key:"formRef",ref:_},{default:a(()=>[l(b,{label:"用户姓名",prop:"username"},{default:a(()=>[l(r,{placeholder:"请您输入用户姓名",modelValue:n.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户昵称",prop:"name"},{default:a(()=>[l(r,{placeholder:"请您输入用户昵称",modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=t=>n.name=t)},null,8,["modelValue"])]),_:1}),n.id?ge("",!0):(v(),y(b,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(r,{placeholder:"请您输入用户密码",modelValue:n.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.password=t)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:a(()=>[q("div",Se,[l(m,{onClick:W},{default:a(()=>[d("取消")]),_:1}),l(m,{type:"primary",onClick:Q},{default:a(()=>[d("确定")]),_:1})])]),_:1},8,["modelValue"]),l(T,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value=t)},{header:a(()=>[qe]),default:a(()=>[l(D,null,{default:a(()=>[l(b,{label:"用户姓名"},{default:a(()=>[l(r,{modelValue:n.username,"onUpdate:modelValue":e[7]||(e[7]=t=>n.username=t),disabled:!0},null,8,["modelValue"])]),_:1}),l(b,{label:"职位列表"},{default:a(()=>[l(j,{onChange:Z,modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=t=>A.value=t),indeterminate:N.value},{default:a(()=>[d("全选")]),_:1},8,["modelValue","indeterminate"]),l(ie,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value=t),onChange:ee},{default:a(()=>[(v(!0),B(M,null,be(V.value,(t,O)=>(v(),y(j,{key:O,label:t},{default:a(()=>[d(F(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:a(()=>[q("div",Ie,[l(m,{onClick:e[10]||(e[10]=t=>w.value=!1)},{default:a(()=>[d("取消")]),_:1}),l(m,{type:"primary",onClick:le},{default:a(()=>[d("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Te=we($e,[["__scopeId","data-v-fe4dc148"]]);export{Te as default};
