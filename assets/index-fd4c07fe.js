import{J as g,d as te,r as u,a as ae,G as oe,e as i,K as ne,o as h,c as se,b as l,w as t,h as c,B as C,v as V,m as B,F as re,A as j,L as S,p as ie,k as de,_ as ue}from"./index-a15cff6e.js";import{u as ce}from"./setting-353a3958.js";const pe=(o,m,p)=>g.get(`/admin/acl/role/${o}/${m}/?roleName=${p}`),me=o=>o.id?g.put("/admin/acl/role/update",o):g.post("/admin/acl/role/save",o),fe=o=>g.get("/admin/acl/permission/toAssign/"+o),_e=(o,m)=>g.post(`/admin/acl/permission/doAssign/?roleId=${o}&permissionId=${m}`),ve=o=>g.delete("/admin/acl/role/remove/"+o),ge=o=>(ie("data-v-0ca29efc"),o=o(),de(),o),ye=ge(()=>B("h4",null,"分配菜单与按钮的权限",-1)),be={style:{flex:"auto"}},ke=te({__name:"index",setup(o){const m=ce(),p=u(1),N=u(10),y=u(""),z=u([]),I=u(0),f=u(!1),w=u(),b=u(!1),r=ae({roleName:""}),U=u([]),R=u([]),$=u();oe(()=>{_()});const _=async(n=1)=>{p.value=n;let e=await pe(p.value,N.value,y.value);e.code==200&&(I.value=e.data.total,z.value=e.data.records)},D=()=>{_()},O=()=>{_(),y.value=""},T=()=>{m.refresh=!m.refresh},K=()=>{f.value=!0,Object.assign(r,{roleName:"",id:0}),j(()=>{w.value.clearValidate("roleName")})},L=n=>{f.value=!0,Object.assign(r,n),j(()=>{w.value.clearValidate("roleName")})},M={roleName:[{required:!0,trigger:"blur",validator:(n,e,s)=>{e.trim().length>=2?s():s(new Error("职位名称至少两位"))}}]},F=async()=>{await w.value.validate(),(await me(r)).code==200&&(S({type:"success",message:r.id?"更新成功":"添加成功"}),f.value=!1,_(r.id?p.value:1))},H=async n=>{b.value=!0,Object.assign(r,n);let e=await fe(r.id);e.code==200&&(R.value=e.data,U.value=q(R.value,[]))},G={children:"children",label:"name"},q=(n,e)=>(n.forEach(s=>{s.select&&s.level==4&&e.push(s.id),s.children&&s.children.length>0&&q(s.children,e)}),e),J=async()=>{const n=r.id;let e=$.value.getCheckedKeys(),s=$.value.getHalfCheckedKeys(),k=e.concat(s);(await _e(n,k)).code==200&&(b.value=!1,S({type:"success",message:"分配权限成功"}),window.location.reload())},Q=async n=>{(await ve(n)).code==200&&(S({type:"success",message:"删除成功"}),_(z.value.length>1?p.value:p.value-1))};return(n,e)=>{const s=i("el-input"),k=i("el-form-item"),d=i("el-button"),A=i("el-form"),P=i("el-card"),v=i("el-table-column"),W=i("el-popconfirm"),X=i("el-table"),Y=i("el-pagination"),Z=i("el-dialog"),ee=i("el-tree"),le=i("el-drawer"),x=ne("has");return h(),se(re,null,[l(P,null,{default:t(()=>[l(A,{inline:!0,class:"form"},{default:t(()=>[l(k,{label:"职位搜索"},{default:t(()=>[l(s,{placeholder:"请你输入搜索职位关键字",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a)},null,8,["modelValue"])]),_:1}),l(k,null,{default:t(()=>[l(d,{type:"primary",size:"default",disabled:!y.value,onClick:O},{default:t(()=>[c("搜索")]),_:1},8,["disabled"]),l(d,{type:"primary",size:"default",onClick:T},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{style:{margin:"10px 0px"}},{default:t(()=>[C((h(),V(d,{type:"primary",size:"default",icon:"Plus",onClick:K},{default:t(()=>[c("添加职位")]),_:1})),[[x,"btn.Role.add"]]),l(X,{border:"",style:{margin:"10px 0px"},data:z.value},{default:t(()=>[l(v,{type:"index",align:"center",label:"#"}),l(v,{label:"ID",align:"center",prop:"id"}),l(v,{label:"职位名称",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(v,{label:"创建世间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(v,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(v,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:we})=>[C((h(),V(d,{type:"primary",size:"small",icon:"User",onClick:E=>H(a)},{default:t(()=>[c(" 分配权限 ")]),_:2},1032,["onClick"])),[[x,"btn.Role.assgin"]]),C((h(),V(d,{type:"primary",size:"small",icon:"Edit",onClick:E=>L(a)},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"])),[[x,"btn.Role.update"]]),l(W,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:E=>Q(a.id)},{reference:t(()=>[C((h(),V(d,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>[c("删除")]),_:1})),[[x,"btn.Role.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(Y,{"current-page":p.value,"onUpdate:currentPage":e[1]||(e[1]=a=>p.value=a),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=a=>N.value=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:I.value,onCurrentChange:_,onSizeChange:D},null,8,["current-page","page-size","total"])]),_:1}),l(Z,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),title:r.id?"更新职位":"添加职位"},{footer:t(()=>[l(d,{type:"primary",size:"default",onClick:e[4]||(e[4]=a=>f.value=!1)},{default:t(()=>[c("取消")]),_:1}),l(d,{type:"primary",size:"default",onClick:F},{default:t(()=>[c("确定")]),_:1})]),default:t(()=>[l(A,{model:r,rules:M,ref_key:"form",ref:w},{default:t(()=>[l(k,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(s,{placeholder:"请你输入职位名称",modelValue:r.roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>r.roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(le,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=a=>b.value=a)},{header:t(()=>[ye]),default:t(()=>[l(ee,{ref_key:"tree",ref:$,data:R.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":U.value,props:G},null,8,["data","default-checked-keys"])]),footer:t(()=>[B("div",be,[l(d,{onClick:e[6]||(e[6]=a=>b.value=!1)},{default:t(()=>[c("取消")]),_:1}),l(d,{type:"primary",onClick:J},{default:t(()=>[c("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const Ve=ue(ke,[["__scopeId","data-v-0ca29efc"]]);export{Ve as default};
