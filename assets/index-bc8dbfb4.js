import{d as K,s as M,O as x,r as C,a as Q,H as G,z as W,e as i,K as X,o as m,c as N,b as e,w as l,B as _,m as z,v as k,f as Y,h as p,F as Z,q as ee,t as B,C as $,A as O,P as te,L as v,Q as ae,R as le}from"./index-a15cff6e.js";const ne=["onClick"],oe=K({__name:"index",setup(re){const{c1Id:w,c2Id:D,c3Id:f}=M(x()),y=C([]),u=C(0),a=Q({attrName:"",attrValueList:[],categoryId:"",categoryLevel:3}),g=C([]),b=async()=>{let n=await le(w.value,D.value,f.value);n.code===200&&(y.value=n.data)},I=()=>{Object.assign(a,{id:"",attrName:"",attrValueList:[],categoryId:f.value,categoryLevel:3}),u.value=1},S=n=>{u.value=1,Object.assign(a,JSON.parse(JSON.stringify(n)))},U=()=>{a.attrValueList.push({valueName:"",flag:!0}),O(()=>{g.value[a.attrValueList.length-1].focus()})},q=async()=>{(await te(a)).code===200?(u.value=0,v.success(a.id?"修改成功":"添加成功"),b()):v.error(a.id?"修改失败":"添加失败")},E=(n,r)=>{if(n.valueName.trim()==""){a.attrValueList.splice(r,1),v.error("属性值不能为空");return}if(a.attrValueList.find(s=>{if(s!=n)return s.valueName===n.valueName})){v.error("属性值不能重复"),a.attrValueList.splice(r,1);return}n.flag=!1},P=(n,r)=>{n.flag=!0,O(()=>{g.value[r].focus()})},R=async n=>{(await ae(n)).code===200&&(v.success("删除成功"),b())};return G(()=>{x().$reset()}),W(()=>f.value,()=>{y.value=[],f.value&&b()}),(n,r)=>{const L=i("Category"),s=i("el-button"),d=i("el-table-column"),T=i("el-tag"),j=i("el-popconfirm"),A=i("el-table"),h=i("el-input"),F=i("el-form-item"),J=i("el-form"),H=i("el-card"),V=X("has");return m(),N("div",null,[e(L,{scene:u.value},null,8,["scene"]),e(H,null,{default:l(()=>[_(z("div",null,[_((m(),k(s,{type:"primary",size:"default",icon:"Plus",disabled:!Y(f),onClick:I},{default:l(()=>[p(" 添加属性 ")]),_:1},8,["disabled"])),[[V,"btn.Attr.add"]]),e(A,{data:y.value,border:"",style:{margin:"10px 0"}},{default:l(()=>[e(d,{label:"序号",type:"index",align:"center",width:"80"}),e(d,{label:"属性名称",prop:"attrName",width:"150"}),e(d,{label:"属性值名称"},{default:l(({row:t,$index:c})=>[(m(!0),N(Z,null,ee(t.attrValueList,o=>(m(),k(T,{style:{margin:"5px"},key:o.id},{default:l(()=>[p(B(o.valueName),1)]),_:2},1024))),128))]),_:1}),e(d,{label:"操作",prop:"",width:"150"},{default:l(({row:t,$index:c})=>[_(e(s,{type:"warning",size:"small",icon:"Edit",onClick:o=>S(t)},null,8,["onClick"]),[[V,"btn.Attr.update"]]),e(j,{title:`你确定删除${t.attrName}?`,width:"200px",onConfirm:o=>R(t.id)},{reference:l(()=>[_(e(s,{type:"danger",size:"small",icon:"Delete"},null,512),[[V,"btn.Attr.remove"]])]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[$,u.value==0]]),_(z("div",null,[e(J,{inline:""},{default:l(()=>[e(F,{label:"属性名称"},{default:l(()=>[e(h,{placeholder:"请你输入属性名称",modelValue:a.attrName,"onUpdate:modelValue":r[0]||(r[0]=t=>a.attrName=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{type:"primary",size:"default",disabled:!a.attrName,onClick:U},{default:l(()=>[p("添加属性值")]),_:1},8,["disabled"]),e(s,{type:"primary",size:"default",onClick:r[1]||(r[1]=t=>u.value=0)},{default:l(()=>[p("取消")]),_:1}),e(A,{border:"",data:a.attrValueList,style:{margin:"10px 0"}},{default:l(()=>[e(d,{label:"序号",type:"index",width:"80",align:"center"}),e(d,{label:"属性值"},{default:l(({row:t,$index:c})=>[t.flag?(m(),k(h,{key:0,ref:o=>g.value[c]=o,size:"small",placeholder:"请你输入属性值名称",modelValue:t.valueName,"onUpdate:modelValue":o=>t.valueName=o,onBlur:o=>E(t,c)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(m(),N("div",{key:1,onClick:o=>P(t,c)},B(t.valueName),9,ne))]),_:1}),e(d,{label:"操作"},{default:l(({row:t,$index:c})=>[e(s,{type:"danger",size:"small",icon:"Delete",onClick:o=>a.attrValueList.splice(c,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(s,{type:"primary",size:"default",onClick:q,disabled:a.attrValueList.length==0},{default:l(()=>[p("保存")]),_:1},8,["disabled"]),e(s,{type:"primary",size:"default",onClick:r[2]||(r[2]=t=>u.value=0)},{default:l(()=>[p("取消")]),_:1})],512),[[$,u.value==1]])]),_:1})])}}});export{oe as default};
